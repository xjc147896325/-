<h1><b style:"color:red">麻烦用猪脑子好好看清楚，报文净荷极限长度296，单位是bit，也就是37Bytes，别几把再闹笑话了，好几天了，差点就要去问人了，这几把问题肯定搜不到啊。</b></h1>


<ol>
  <h1><li>
    蓝牙简介：</h1>
    <p>蓝牙从最开始1Mbps的速度，往后2版本逐渐增速，甚至在V3的时候达到54Mbps，但在V4的时候，出现了分叉，部分蓝牙（面向音频等）继续增速，，但是增速会带来另一个问题：功耗，越来越多的可穿戴嵌入式设备的出现，以及部分智能设备，使用纽扣电池供电，对于功耗十分的敏感，因此充分考虑低功耗，BLE出现了。</p>
    <p>低功耗蓝牙可以构建2种设备类型，单模和双模，顾名思义，双模蓝牙支持2种模式，而单模只支持BLE，当然，也存在只支持经典蓝牙的设备，在此由于方向性，不做考虑。</p>
  </li>
  
  <h1><li>
    一些基本概念：</h1>
    <ol>
      <h3><li>
        纽扣电池：</h3>
        <p>纽扣电池是BLE的主要受众，例如CR2032，CR表示其是一个3V锂二氧化锰电池，20表示其直径为20mm，32表示高为3.2mm，以此类推。</p>
        <p>一个典型的CR2032的额定容量在3V时为230mAh，但设备无法完全获得其能量。</p>
        <p>首先，温度越低，电池可供能越少，在0℃情况下较常温仅能提供80%能量。</p>
        <p>其次，如果持续使用，可用总能量会显著降低，通常情况下一般纽扣电池会存在15mA的一个峰值电流，使用时超过该电流很容易损坏电池，长时间峰值供电也会使得可用总能量降低，因此设计时应考虑长时间或者大电流供电后恢复一段时间。</p>
        <p>最后，电池本身也会漏电，哪怕设备未取电，电池电量仍会逐渐减少，如果使用环境时偶尔使用，漏电问题将被着重考虑。</p>
      </li>
      <h3><li>
        时间即能量：</h3>
        <p>时间是在BLE设计中很重要的一环，因为一旦无线设备开始工作后就需要使用能量，因此减少操作时间十分的重要。</p>
        <p>简单来说，优化鲁棒的发现设备、链接设备和发送数据。</p>
        <p>其中发现设备要求至少2个设备，一个寻找，其他的处于可发现状态，BLE中设备想被发现则需要隔几秒发送3次短消息，分别在不同的频率进行，如果设备想发现，则需要在广播后立即侦听。</p>
        <p>BLE中数据报文长度设计的很短，因为高效率编码，提高数据密集度；限制设备仅可使用短报文也消除了控制器在一次传输中需要不断校准无线电需求的问题，因为在通讯中模块会发热，改变硅芯片的特性；短报文也降低了峰值功率，从而减轻电池压力。</p>
      </li>
      <h3><li>
        昂贵的内存：</h3>
        <p>内存的问题不仅是价格，还有功率，DRAM需要额外功率维持内存数据稳定，SRAM又过分昂贵，因此尽可能减少内存的使用也是BLE中重要的一环。</p>
      </li>
      <h3><li>
        非对称设计：</h3>
        <p>非对称设计贯穿BLE的体系结构，为了更少的减轻设备负担与能源消耗，这种设计十分重要。</p>
        <h4>物理层：</h4>
        <p>通常有2种无线电：接收器与发射器。一个设备可以既有发射器也有接收器，当然也可以只有发射器或者接收器，一个设备只有发射机而另一个设备只有接收器，这样被称之为非对称网络。<b style="color:red;">这种不对称的设计源于一个基本的假设：所有其他设备必须为资源最有限的设备进行优化。</b></p>
        <h4>链路层：</h4>
        <p>设备通常在链路层被分为4种：广播者、扫描者、从设备与主设备。</p>
        <p>广播者是传输数据包的设备，扫描者是接收数据包的设备，从设备和主设备相连。在这里也体现了不对称设计。从设备无法发起任何复杂的操作，而主设备则必须在负责piconet约定的定时、自适应跳频集合设置、加密以及一些其他的复杂操作。而从设备只需要完成按要求的操作，不必进行复杂处理，这样从设备可以低功耗、低成本、低内存。</p>
        <h4>属性协议层：</h4>
        <p>存在2种设备：客户端和服务器。服务器保存数据，客户端发送请求以得到数据。服务器就相当于链路层的从设备，只响应要求，客户端工作相对较多类似于链路层的主设备。</p>
        <h4>安全架构：</h4>
        <p>即使是低功耗的安全架构也是非对称的，基于一种密钥分配方案：由从设备提从密钥，将其给主设备并保存至主设备。主设备负责保存链路绑定信息，从设备无需记忆任何信息。这意味着从设备的实现安全特性相对简单，而主设备会复杂一些。</p>
      </li>
    </ol>
    <p>因此那些资源受限的设备将作为广播者、从设备或者服务器。这类设备拥有最少的可用内存以及处理负担，得益于非对称的设计实现了超低功耗。</p>
    <p>其他的设备类型：扫描者、主设备或者客户端则拥有相对较多的可用资源。这些设备通常装备较大的电池，拥有更丰富的GUI，甚至可能由市电供电。将负担主要移动到了主设备、扫描者和客户端，这种选择也是正确的，正式这一选择降低了资源受限设备的功耗，将成本更多的转移到资源丰富的设备上。</p>
  <h1><li>
    无线电相关（主要扩频）：</h1>
    <pre>
    适当拓宽无线电信号的好处在于无线电将遵循<a href='https://zh.wikipedia.org/wiki/%E6%89%A9%E9%A2%91' target="_blank">扩频（spread-spectrum）</a>的约束，
而经典蓝牙无线电则受<a href='https://zh.wikipedia.org/wiki/%E8%B7%B3%E9%A2%91%E6%89%A9%E9%A2%91' target='_blank'>跳频</a>的约束。传输时，扩频无线电要比跳频无线电使用的频率更少。
如果没有更宽松的滤波器波形，低功耗蓝牙将不能旨在三个信道上广播，而不得不使用更多的信道，
从而导致系统的能耗升高。
    </pre>
    <p>这段取自<b>《低功耗蓝牙开发权威指南》一.3.1.1 物理层</b>，目前基本上完全不理解，可能和我完全没学过射频微电子学有关，存疑，待以后补正。这本书好一笔，建议全文背诵，相较而言《4.0 BLE开发完全手册  物联网开发技术实战》就是臭狗X了，我愿称之为带货书，啥用没有。</p>
  <h1><li>
    链路层算法：白化</h1>
    <a href='https://zhuanlan.zhihu.com/p/108182171' target="_blank">参考这里，主要用在FSK中，用来抗干扰。（spread-spectrum）</a>
    <p>顺带一提，链路层状态机有5态：就绪态，扫描态，广播台，连接态，发起态</p>
    <p>一个概念：<a href='https://baike.baidu.hk/item/%E7%94%9F%E6%88%90%E5%A4%9A%E9%A0%85%E5%BC%8F/22222428' target="_blank">生成多项式</a>,以及<a href='https://blog.csdn.net/ywb201314/article/details/52084281' target="_blank">在CRC中的应用</a></p>
    <p>7.7.3发送窗口，错别字，发送————>发射</p>
    <p>7.10.1链接参数更新，错别字，不管————>不过从设备延迟是多少</p>
    <p>7.10.4重启加密，7-27图中错别字，第二次握手时从机因为加密发送未加密接收</p>
    <p>8.3逻辑接口，第二句单芯片设备上，少了个设字。，下一句话少了个主，这一页都是少字，学习版不大行嗷。
    </p><p>8.6.1与白名单设备发起连接，发起者地址类型中，亦或者是。</p>
  <h1><li>
    链路层概念：滑动窗口</h1>
    <p> <a href='https://baike.baidu.hk/item/%E6%BB%91%E5%8B%95%E7%AA%97%E5%8F%A3/8351795' target="_blank">百度百科。</a></p>
    <p> <a href='https://www.cnblogs.com/huansky/p/13488234.html' target="_blank">算法实现。</a></p>
    <p></p>
    <p></p>
    <p></p>
    <p></p>
    <p></p>
    <p></p>
    <p></p>
    <p></p>
    <p></p>
    <p></p>
    <p></p>
    <p></p>
    <p></p>
    <p></p>
    <p></p>
    <p></p>
    <p></p>
    <p></p>
    <p></p>
    <p></p>
    <p></p>
    <p></p>
    <p></p>
    <p></p>
    <p></p>
    <p></p>
    <p></p>
    <p></p>
    <p></p>
    <p></p>
</ol>
